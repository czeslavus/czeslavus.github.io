(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{Fu6J:function(e,t,i){"use strict";i.r(t),i.d(t,"LockerPageModule",(function(){return f}));var c=i("TEn/"),o=i("ofXK"),n=i("3Pt+"),r=i("qtYk"),s=i("tyNb"),b=i("fXoL"),a=i("WcP9"),l=i("5+tZ"),h=i("vkgz"),u=i("lJxs"),d=i("cp0P");let g=(()=>{class e{constructor(e){this.ble=e}config(e){this._config=e}connectDevice(){return this.ble.discover$({acceptAllDevices:!0,optionalServices:[this._config.infoService,this._config.controlService]}).pipe(Object(l.a)(e=>(this.gatt=e,Object(d.a)({battery:this.ble.getPrimaryService$(e,this._config.infoService),open:this.ble.getPrimaryService$(e,this._config.controlService)}))),Object(h.a)(e=>{this.infoService=e.battery,this.controlService=e.open,console.log("mamy to!")}))}subscribeToRead(){return this.ble.getCharacteristic$(this.infoService,this._config.batteryLevelChar).pipe(Object(l.a)(e=>this.ble.observeValue$(e)),Object(u.a)(e=>(console.log(e),this.ble.littleEndianToUint16(e,0))))}subscribeToOccupied(){return this.ble.getCharacteristic$(this.infoService,this._config.occupiedChar).pipe(Object(l.a)(e=>this.ble.observeValue$(e)),Object(u.a)(e=>e.getInt8(0)))}subscribeToState(){return this.ble.getCharacteristic$(this.controlService,this._config.openChar).pipe(Object(l.a)(e=>this.ble.observeValue$(e)),Object(u.a)(e=>(new TextDecoder).decode(e)))}changeState(e){const t=new TextEncoder;let i=t.encode("opened");return e||(i=t.encode("closed")),this.ble.getCharacteristic$(this.controlService,this._config.openChar).pipe(Object(u.a)(e=>this.ble.writeValue$(e,i)))}getDevice(){return this.ble.getDevice$()}stream(){return this.ble.streamValues$().pipe(Object(u.a)(e=>e.getInt16(0)))}value(){return this.ble.value$({service:this._config.infoService,characteristic:this._config.batteryLevelChar})}testRead(){return this.ble.discover$({acceptAllDevices:!0,optionalServices:[this._config.infoService]}).pipe(Object(l.a)(e=>(console.log("Pobieram serwis ... ",e),this.ble.getPrimaryService$(e,this._config.infoService))),Object(l.a)(e=>(console.log("Pobieram dost\u0119p do baterii .... ",e),this.ble.getCharacteristic$(e,this._config.batteryLevelChar))),Object(l.a)(e=>(console.log("Czytam warto\u015bci ...",e),this.ble.observeValue$(e))),Object(u.a)(e=>e.getUint8(0)))}disconnectDevice(){this.ble.disconnectDevice()}}return e.\u0275fac=function(t){return new(t||e)(b.Pb(a.a))},e.\u0275prov=b.Fb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const v=[{path:"",component:(()=>{class e{constructor(e,t){this.ble=e,this.bleService=t,this.isConnected=!1,this.currentValue=0,this.hasErrorVisible=!1,t.config({infoService:"6a4e8bba-a22a-4549-89c8-8eb06c4e6dae",controlService:"f72860b3-dfeb-4c98-b2f7-e61276e585dd",batteryLevelChar:"ef7eb858-9415-4ac1-82d7-4d9eda7ac01e",occupiedChar:"a29792d2-bd9f-430e-b016-525963ec089b",openChar:"1422c6f4-c6a3-4910-955e-99bf158c2cac"})}get device(){return this.bleService.getDevice()}ngOnInit(){this.getDeviceStatus(),this.streamSubscription=this.bleService.stream().subscribe(()=>this.updateValue.bind(this),e=>this.hasError.bind(this))}ngOnDestroy(){this.valuesSubscription.unsubscribe(),this.deviceSubscription.unsubscribe(),this.streamSubscription.unsubscribe()}connectBluetooth(){this.bleService.connectDevice().subscribe(console.log,this.hasError.bind(this))}getDeviceStatus(){this.deviceSubscription=this.bleService.getDevice().subscribe(e=>{e?(console.log("Jest device",e),this.isConnected=!0):(console.log("nie ma device"),this.isConnected=!1)},this.hasError.bind(this))}disconnectBluetooth(){this.bleService.disconnectDevice()}startRead(){this.bleService.subscribeToRead().subscribe(e=>{this.currentTS=new Date,this.currentValue=e},this.hasError.bind(this)),this.bleService.subscribeToOccupied().subscribe(e=>{this.currentOccupied=e},this.hasError.bind(this)),this.bleService.subscribeToState().subscribe(e=>{this.currentIsOpen=e},this.hasError.bind(this))}changeState(e){console.log("Zmieniam stan na ",e),this.bleService.changeState(e).subscribe(e=>{console.log("Po zmianie stanu, ",e)},this.hasError.bind(this))}readBattery(){this.bleService.value().subscribe(e=>{this.currentTS=new Date,this.currentValue=e.getInt8(0)},this.hasError.bind(this))}updateValue(e){this.currentTS=new Date,this.currentValue=e}runBluetooth(){this.bleService.testRead().subscribe(e=>{this.currentTS=new Date,this.currentValue=e})}runByPromises(){let e=window.navigator;e.bluetooth?e.bluetooth.requestDevice({filters:[{services:["automation_io"]}]}).then(e=>(console.log("Nazwa: ",e.name),console.log("Id:    ",e.id),console.log("Connected: ",e.gatt.connected),e.gatt.connect())).then(e=>(console.log("Getting Battery Service..."),e.getPrimaryService("automation_io"))).then(e=>(console.log("Getting Battery Level Characteristic..."),e.getCharacteristic("battery_level"))).then(e=>(console.log("Reading Battery Level..."),e.readValue())).then(e=>{let t=e.getUint8(0);console.log("> Battery Level is "+t+"%")}).catch(e=>{console.warn("Argh!",e)}):console.log("Nie ma API Bluetooth w przegl\u0105darce")}hasError(e){console.error("M\xf3j error",e),this.hasErrorVisible=!0,this.errorMessage=e}}return e.\u0275fac=function(t){return new(t||e)(b.Jb(a.a),b.Jb(g))},e.\u0275cmp=b.Db({type:e,selectors:[["app-locker"]],decls:61,vars:13,consts:[[3,"translucent"],[3,"fullscreen"],["collapse","condense"],["size","large"],[3,"hidden"],["color","danger"],["color","danger","name","close-circle-outline",1,"ion-float-right"],["color","success",1,"ion-float-right",3,"hidden"],["name","bluetooth-outline"],["color","danger",1,"ion-float-right",3,"hidden"],["expand","block",3,"click"]],template:function(e,t){1&e&&(b.Mb(0,"ion-header",0),b.Mb(1,"ion-toolbar"),b.Mb(2,"ion-title"),b.dc(3," Blokada "),b.Lb(),b.Lb(),b.Lb(),b.Mb(4,"ion-content",1),b.Mb(5,"ion-header",2),b.Mb(6,"ion-toolbar"),b.Mb(7,"ion-title",3),b.dc(8,"Blokada"),b.Lb(),b.Lb(),b.Lb(),b.Mb(9,"ion-grid"),b.Mb(10,"ion-row",4),b.Mb(11,"ion-col"),b.Mb(12,"ion-text",5),b.dc(13),b.Lb(),b.Kb(14,"ion-icon",6),b.Lb(),b.Lb(),b.Mb(15,"ion-row"),b.Mb(16,"ion-col"),b.dc(17," Po\u0142\u0105czenie "),b.Lb(),b.Mb(18,"ion-col"),b.Mb(19,"ion-chip",7),b.Kb(20,"ion-icon",8),b.Mb(21,"ion-label"),b.dc(22,"OK"),b.Lb(),b.Lb(),b.Mb(23,"ion-chip",9),b.Kb(24,"ion-icon",8),b.Mb(25,"ion-label"),b.dc(26,"brak"),b.Lb(),b.Lb(),b.Lb(),b.Lb(),b.Mb(27,"ion-row"),b.Mb(28,"ion-col"),b.dc(29,"Akumulator"),b.Lb(),b.Mb(30,"ion-col"),b.dc(31),b.Lb(),b.Mb(32,"ion-col"),b.dc(33),b.Vb(34,"date"),b.Lb(),b.Lb(),b.Mb(35,"ion-row"),b.Mb(36,"ion-col"),b.dc(37,"Zaj\u0119te"),b.Lb(),b.Mb(38,"ion-col"),b.dc(39),b.Lb(),b.Mb(40,"ion-col"),b.dc(41,"Blokada"),b.Lb(),b.Mb(42,"ion-col"),b.dc(43),b.Lb(),b.Lb(),b.Mb(44,"ion-row"),b.Mb(45,"ion-col"),b.Mb(46,"ion-button",10),b.Tb("click",(function(){return t.connectBluetooth()})),b.dc(47,"Po\u0142\u0105cz"),b.Lb(),b.Lb(),b.Mb(48,"ion-col"),b.Mb(49,"ion-button",10),b.Tb("click",(function(){return t.disconnectBluetooth()})),b.dc(50,"Roz\u0142\u0105cz"),b.Lb(),b.Lb(),b.Lb(),b.Mb(51,"ion-row"),b.Mb(52,"ion-col"),b.Mb(53,"ion-button",10),b.Tb("click",(function(){return t.startRead()})),b.dc(54,"Czytaj"),b.Lb(),b.Lb(),b.Mb(55,"ion-col"),b.Mb(56,"ion-button",10),b.Tb("click",(function(){return t.changeState(!0)})),b.dc(57,"Otw\xf3rz"),b.Lb(),b.Lb(),b.Mb(58,"ion-col"),b.Mb(59,"ion-button",10),b.Tb("click",(function(){return t.changeState(!1)})),b.dc(60,"Zamknij"),b.Lb(),b.Lb(),b.Lb(),b.Lb(),b.Lb()),2&e&&(b.Zb("translucent",!0),b.zb(4),b.Zb("fullscreen",!0),b.zb(6),b.Zb("hidden",!t.hasErrorVisible),b.zb(3),b.ec(t.errorMessage),b.zb(6),b.Zb("hidden",!t.isConnected),b.zb(4),b.Zb("hidden",t.isConnected),b.zb(8),b.ec(t.currentValue),b.zb(2),b.ec(b.Wb(34,10,t.currentTS,"HH:mm:ss")),b.zb(6),b.ec(t.currentOccupied),b.zb(4),b.ec(t.currentIsOpen))},directives:[c.g,c.q,c.p,c.e,c.f,c.k,c.d,c.o,c.h,c.c,c.i,c.b],pipes:[o.d],styles:[""]}),e})()}];let p=(()=>{class e{}return e.\u0275mod=b.Hb({type:e}),e.\u0275inj=b.Gb({factory:function(t){return new(t||e)},imports:[[s.i.forChild(v)],s.i]}),e})(),f=(()=>{class e{}return e.\u0275mod=b.Hb({type:e}),e.\u0275inj=b.Gb({factory:function(t){return new(t||e)},imports:[[c.r,o.b,n.a,r.a,p]]}),e})()}}]);