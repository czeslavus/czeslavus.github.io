function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{Fu6J:function(e,t,n){"use strict";n.r(t),n.d(t,"LockerPageModule",(function(){return L}));var i,c,o,r,a=n("TEn/"),s=n("ofXK"),b=n("3Pt+"),u=n("qtYk"),l=n("tyNb"),h=n("fXoL"),f=n("WcP9"),d=n("5+tZ"),v=n("vkgz"),g=n("lJxs"),p=n("cp0P"),y=((i=function(){function e(t){_classCallCheck(this,e),this.ble=t}return _createClass(e,[{key:"config",value:function(e){this._config=e}},{key:"connectDevice",value:function(){var e=this;return this.ble.discover$({acceptAllDevices:!0,optionalServices:[this._config.infoService,this._config.controlService]}).pipe(Object(d.a)((function(t){return e.gatt=t,Object(p.a)({battery:e.ble.getPrimaryService$(t,e._config.infoService),open:e.ble.getPrimaryService$(t,e._config.controlService)})})),Object(v.a)((function(t){e.infoService=t.battery,e.controlService=t.open,console.log("mamy to!")})))}},{key:"subscribeToRead",value:function(){var e=this;return this.ble.getCharacteristic$(this.infoService,this._config.batteryLevelChar).pipe(Object(d.a)((function(t){return e.ble.observeValue$(t)})),Object(g.a)((function(t){return console.log(t),e.ble.littleEndianToUint16(t,0)})))}},{key:"subscribeToOccupied",value:function(){var e=this;return this.ble.getCharacteristic$(this.infoService,this._config.occupiedChar).pipe(Object(d.a)((function(t){return e.ble.observeValue$(t)})),Object(g.a)((function(e){return e.getInt8(0)})))}},{key:"subscribeToState",value:function(){var e=this;return this.ble.getCharacteristic$(this.controlService,this._config.openChar).pipe(Object(d.a)((function(t){return e.ble.observeValue$(t)})),Object(g.a)((function(e){return(new TextDecoder).decode(e)})))}},{key:"changeState",value:function(e){var t=this,n=new TextEncoder,i=n.encode("opened");return e||(i=n.encode("closed")),this.ble.getCharacteristic$(this.controlService,this._config.openChar).pipe(Object(g.a)((function(e){return t.ble.writeValue$(e,i)})))}},{key:"getDevice",value:function(){return this.ble.getDevice$()}},{key:"stream",value:function(){return this.ble.streamValues$().pipe(Object(g.a)((function(e){return e.getInt16(0)})))}},{key:"value",value:function(){return this.ble.value$({service:this._config.infoService,characteristic:this._config.batteryLevelChar})}},{key:"testRead",value:function(){var e=this;return this.ble.discover$({acceptAllDevices:!0,optionalServices:[this._config.infoService]}).pipe(Object(d.a)((function(t){return console.log("Pobieram serwis ... ",t),e.ble.getPrimaryService$(t,e._config.infoService)})),Object(d.a)((function(t){return console.log("Pobieram dost\u0119p do baterii .... ",t),e.ble.getCharacteristic$(t,e._config.batteryLevelChar)})),Object(d.a)((function(t){return console.log("Czytam warto\u015bci ...",t),e.ble.observeValue$(t)})),Object(g.a)((function(e){return e.getUint8(0)})))}},{key:"disconnectDevice",value:function(){this.ble.disconnectDevice()}}]),e}()).\u0275fac=function(e){return new(e||i)(h.Pb(f.a))},i.\u0275prov=h.Fb({token:i,factory:i.\u0275fac,providedIn:"root"}),i),S=[{path:"",component:(c=function(){function e(t,n){_classCallCheck(this,e),this.ble=t,this.bleService=n,this.isConnected=!1,this.currentValue=0,this.hasErrorVisible=!1,n.config({infoService:"6a4e8bba-a22a-4549-89c8-8eb06c4e6dae",controlService:"f72860b3-dfeb-4c98-b2f7-e61276e585dd",batteryLevelChar:"ef7eb858-9415-4ac1-82d7-4d9eda7ac01e",occupiedChar:"a29792d2-bd9f-430e-b016-525963ec089b",openChar:"1422c6f4-c6a3-4910-955e-99bf158c2cac"})}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.getDeviceStatus(),this.streamSubscription=this.bleService.stream().subscribe((function(){return e.updateValue.bind(e)}),(function(t){return e.hasError.bind(e)}))}},{key:"ngOnDestroy",value:function(){this.valuesSubscription.unsubscribe(),this.deviceSubscription.unsubscribe(),this.streamSubscription.unsubscribe()}},{key:"connectBluetooth",value:function(){this.bleService.connectDevice().subscribe(console.log,this.hasError.bind(this))}},{key:"getDeviceStatus",value:function(){var e=this;this.deviceSubscription=this.bleService.getDevice().subscribe((function(t){t?(console.log("Jest device",t),e.isConnected=!0):(console.log("nie ma device"),e.isConnected=!1)}),this.hasError.bind(this))}},{key:"disconnectBluetooth",value:function(){this.bleService.disconnectDevice()}},{key:"startRead",value:function(){var e=this;this.bleService.subscribeToRead().subscribe((function(t){e.currentTS=new Date,e.currentValue=t}),this.hasError.bind(this)),this.bleService.subscribeToOccupied().subscribe((function(t){e.currentOccupied=t}),this.hasError.bind(this)),this.bleService.subscribeToState().subscribe((function(t){e.currentIsOpen=t}),this.hasError.bind(this))}},{key:"changeState",value:function(e){console.log("Zmieniam stan na ",e),this.bleService.changeState(e).subscribe((function(e){console.log("Po zmianie stanu, ",e)}),this.hasError.bind(this))}},{key:"readBattery",value:function(){var e=this;this.bleService.value().subscribe((function(t){e.currentTS=new Date,e.currentValue=t.getInt8(0)}),this.hasError.bind(this))}},{key:"updateValue",value:function(e){this.currentTS=new Date,this.currentValue=e}},{key:"runBluetooth",value:function(){var e=this;this.bleService.testRead().subscribe((function(t){e.currentTS=new Date,e.currentValue=t}))}},{key:"runByPromises",value:function(){var e=window.navigator;e.bluetooth?e.bluetooth.requestDevice({filters:[{services:["automation_io"]}]}).then((function(e){return console.log("Nazwa: ",e.name),console.log("Id:    ",e.id),console.log("Connected: ",e.gatt.connected),e.gatt.connect()})).then((function(e){return console.log("Getting Battery Service..."),e.getPrimaryService("automation_io")})).then((function(e){return console.log("Getting Battery Level Characteristic..."),e.getCharacteristic("battery_level")})).then((function(e){return console.log("Reading Battery Level..."),e.readValue()})).then((function(e){var t=e.getUint8(0);console.log("> Battery Level is "+t+"%")})).catch((function(e){console.warn("Argh!",e)})):console.log("Nie ma API Bluetooth w przegl\u0105darce")}},{key:"hasError",value:function(e){console.error("M\xf3j error",e),this.hasErrorVisible=!0,this.errorMessage=e}},{key:"device",get:function(){return this.bleService.getDevice()}}]),e}(),c.\u0275fac=function(e){return new(e||c)(h.Jb(f.a),h.Jb(y))},c.\u0275cmp=h.Db({type:c,selectors:[["app-locker"]],decls:61,vars:13,consts:[[3,"translucent"],[3,"fullscreen"],["collapse","condense"],["size","large"],[3,"hidden"],["color","danger"],["color","danger","name","close-circle-outline",1,"ion-float-right"],["color","success",1,"ion-float-right",3,"hidden"],["name","bluetooth-outline"],["color","danger",1,"ion-float-right",3,"hidden"],["expand","block",3,"click"]],template:function(e,t){1&e&&(h.Mb(0,"ion-header",0),h.Mb(1,"ion-toolbar"),h.Mb(2,"ion-title"),h.dc(3," Blokada "),h.Lb(),h.Lb(),h.Lb(),h.Mb(4,"ion-content",1),h.Mb(5,"ion-header",2),h.Mb(6,"ion-toolbar"),h.Mb(7,"ion-title",3),h.dc(8,"Blokada"),h.Lb(),h.Lb(),h.Lb(),h.Mb(9,"ion-grid"),h.Mb(10,"ion-row",4),h.Mb(11,"ion-col"),h.Mb(12,"ion-text",5),h.dc(13),h.Lb(),h.Kb(14,"ion-icon",6),h.Lb(),h.Lb(),h.Mb(15,"ion-row"),h.Mb(16,"ion-col"),h.dc(17," Po\u0142\u0105czenie "),h.Lb(),h.Mb(18,"ion-col"),h.Mb(19,"ion-chip",7),h.Kb(20,"ion-icon",8),h.Mb(21,"ion-label"),h.dc(22,"OK"),h.Lb(),h.Lb(),h.Mb(23,"ion-chip",9),h.Kb(24,"ion-icon",8),h.Mb(25,"ion-label"),h.dc(26,"brak"),h.Lb(),h.Lb(),h.Lb(),h.Lb(),h.Mb(27,"ion-row"),h.Mb(28,"ion-col"),h.dc(29,"Akumulator"),h.Lb(),h.Mb(30,"ion-col"),h.dc(31),h.Lb(),h.Mb(32,"ion-col"),h.dc(33),h.Vb(34,"date"),h.Lb(),h.Lb(),h.Mb(35,"ion-row"),h.Mb(36,"ion-col"),h.dc(37,"Zaj\u0119te"),h.Lb(),h.Mb(38,"ion-col"),h.dc(39),h.Lb(),h.Mb(40,"ion-col"),h.dc(41,"Blokada"),h.Lb(),h.Mb(42,"ion-col"),h.dc(43),h.Lb(),h.Lb(),h.Mb(44,"ion-row"),h.Mb(45,"ion-col"),h.Mb(46,"ion-button",10),h.Tb("click",(function(){return t.connectBluetooth()})),h.dc(47,"Po\u0142\u0105cz"),h.Lb(),h.Lb(),h.Mb(48,"ion-col"),h.Mb(49,"ion-button",10),h.Tb("click",(function(){return t.disconnectBluetooth()})),h.dc(50,"Roz\u0142\u0105cz"),h.Lb(),h.Lb(),h.Lb(),h.Mb(51,"ion-row"),h.Mb(52,"ion-col"),h.Mb(53,"ion-button",10),h.Tb("click",(function(){return t.startRead()})),h.dc(54,"Czytaj"),h.Lb(),h.Lb(),h.Mb(55,"ion-col"),h.Mb(56,"ion-button",10),h.Tb("click",(function(){return t.changeState(!0)})),h.dc(57,"Otw\xf3rz"),h.Lb(),h.Lb(),h.Mb(58,"ion-col"),h.Mb(59,"ion-button",10),h.Tb("click",(function(){return t.changeState(!1)})),h.dc(60,"Zamknij"),h.Lb(),h.Lb(),h.Lb(),h.Lb(),h.Lb()),2&e&&(h.Zb("translucent",!0),h.zb(4),h.Zb("fullscreen",!0),h.zb(6),h.Zb("hidden",!t.hasErrorVisible),h.zb(3),h.ec(t.errorMessage),h.zb(6),h.Zb("hidden",!t.isConnected),h.zb(4),h.Zb("hidden",t.isConnected),h.zb(8),h.ec(t.currentValue),h.zb(2),h.ec(h.Wb(34,10,t.currentTS,"HH:mm:ss")),h.zb(6),h.ec(t.currentOccupied),h.zb(4),h.ec(t.currentIsOpen))},directives:[a.g,a.q,a.p,a.e,a.f,a.k,a.d,a.o,a.h,a.c,a.i,a.b],pipes:[s.d],styles:[""]}),c)}],k=((r=function e(){_classCallCheck(this,e)}).\u0275mod=h.Hb({type:r}),r.\u0275inj=h.Gb({factory:function(e){return new(e||r)},imports:[[l.i.forChild(S)],l.i]}),r),L=((o=function e(){_classCallCheck(this,e)}).\u0275mod=h.Hb({type:o}),o.\u0275inj=h.Gb({factory:function(e){return new(e||o)},imports:[[a.r,s.b,b.a,u.a,k]]}),o)}}]);